{% set bdata = box.alerts %}
{% extends 'application/box.html' %}

{% block boxinfo %}
{% if alerts %}
    <div id="alert-display">
        <div class="alert-event"><i class="fa-solid fa-triangle-exclamation"></i> {{ alerts[0].event }} <i class="fa-solid fa-triangle-exclamation"></i></div>
        <div class="alert-headline">{{ alerts[0].headline }}</div>
    </div>
    <script>
        let event = document.getElementsByClassName('alert-event')[0];
        event.classList.add(alertColor("{{alerts[0].event}}"));
    </script>
    {% if alerts|length > 1 %}
    <div class="alert-nav">
        <span onclick="prevAlert()" class="alert-nav-btn alert-button"><i class="fa-solid fa-chevron-up"></i></span>
        <span id="alert-counter">1 of {{ alerts|length }}</span>
        <span onclick="nextAlert()" class="alert-nav-btn alert-button"><i class="fa-solid fa-chevron-down"></i></span>
    </div>

    <script>
        let currentAlert = 0;
        const alertsList = {{ alerts|tojson|safe }};
        
        function showAlert(index) {
            const display = document.getElementById('alert-display');
            const eventClass = alertColor(alertsList[index].event);
            display.innerHTML = `
                <div class="alert-event ${eventClass}"><i class="fa-solid fa-triangle-exclamation"></i> ${alertsList[index].event} <i class="fa-solid fa-triangle-exclamation"></i></div>
                <div class="alert-headline">${alertsList[index].headline}</div>
            `;
            document.getElementById('alert-counter').textContent = `${index + 1} of ${alertsList.length}`;
        }

        function nextAlert() {
            currentAlert = (currentAlert + 1) % alertsList.length;
            showAlert(currentAlert);
        }

        function prevAlert() {
            currentAlert = (currentAlert - 1 + alertsList.length) % alertsList.length;
            showAlert(currentAlert);
        }
    </script>
    {% endif %}
{% else %}
    <div class="no-alerts">No active alerts</div>
{% endif %}
{% endblock %}