stages:
  - build
  - lint
  - build docker

cache:
  untracked: true
  key: ${CI_COMMIT_REF_SLUG}
  paths:
    - node_modules/

build ui:
  stage: build
  script:
    - cd weather-ui
    - npm install


lint server:
  stage: lint
  script:
    - cd weather-server
    - staticcheck ./...

lint ui:
  stage: lint
  script:
    - cd weather-ui
    - ls -l
    - npm run lint


ui:
  stage: build docker
  script:
    - cd weather-ui
    - docker build -t $DOCKER_REGISTRY/production/weather-ui:1.6 .
    - docker push $DOCKER_REGISTRY/production/weather-ui:1.6

server:
  stage: build docker
  script:
    - cd weather-server
    - docker build -t $DOCKER_REGISTRY/production/weather-server:1.7 .
    - docker push $DOCKER_REGISTRY/production/weather-server:1.7

notify:
  stage: build docker
  script:
    - cd weather-notify
    - docker build -t $DOCKER_REGISTRY/production/weather-notify:1.0 .
    - docker push $DOCKER_REGISTRY/production/weather-notify:1.0

